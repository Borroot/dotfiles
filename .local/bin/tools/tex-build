#!/usr/bin/env bash
# AUTHOR: Bram Pulles

# This program is run with in $1 a tex file and build it.
if [[ -z $1 ]] || [[ ! $1 =~ .tex$ ]]
then
	>&2 echo "Please provide a tex file."
	exit 1
fi

# Extract just the filename without the extension.
tmp=$(basename "$1")
readonly FILE=${tmp%.*}

# Build the given tex file, three times so the references are made.
# If there is no bib file then only compile once.
# The -shell-escape flag is for the `minted` package.
cd $(dirname "$1")

if [[ $(find $directory -type f -name '*.bib' | wc -l) > 0 ]]
then
	pdflatex -shell-escape "$FILE"
	bibtex "$FILE"
	pdflatex -shell-escape "$FILE"
	pdflatex -shell-escape "$FILE"
else
	pdflatex -shell-escape "$FILE"
fi
